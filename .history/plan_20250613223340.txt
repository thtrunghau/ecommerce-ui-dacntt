// PHÃ‚N TÃCH DTO, SCHEMA, API RESPONSE BACKEND (final-ecommerce-api-main)

--- PRODUCT ---
ProductResDto (extends ProductReqDto):
{
  id: string (UUID),
  productName: string,
  image: string,
  description: string,
  quantity: number,
  price: number,
  categoryId: string (UUID)
}

API: GET /v1/products?page=0&pageSize=10
Response:
{
  currentPage: number,
  pageSize: number,
  totalPages: number,
  totalElements: number,
  isLast: boolean,
  isFirst: boolean,
  data: ProductResDto[]
}

--- CATEGORY ---
CategoryResDto (extends CategoryReqDto):
{
  id: string (UUID),
  categoryName: string,
  products: ProductResDto[]
}

API: GET /v1/categories?page=0&pageSize=10
Response:
{
  currentPage: number,
  pageSize: number,
  totalPages: number,
  totalElements: number,
  isLast: boolean,
  isFirst: boolean,
  data: CategoryResDto[]
}

API: GET /v1/categories/{id}
Response: CategoryResDto

--- CART ITEM ---
CartItemResDto (extends CartItemReqDto):
{
  id: string (UUID),
  productPrice: number,
  quantity: number,
  cartId: string (UUID),
  product: ProductResDto
}

--- ADDRESS ---
AddressResDto (extends AddressReqDto):
{
  id: string (UUID),
  street: string,
  buildingName: string,
  city: string,
  country: string,
  state: string,
  pincode: string,
  accountId: string (UUID)
}

API: GET /v1/addresses?page=0&pageSize=10
Response:
{
  currentPage: number,
  pageSize: number,
  totalPages: number,
  totalElements: number,
  isLast: boolean,
  isFirst: boolean,
  data: AddressResDto[]
}

--- PROMOTION ---
PromotionResDto (extends PromotionReqDto):
{
  id: string (UUID),
  promotionName: string,
  promotionCode: string,
  description: string,
  startDate: string (ISO),
  endDate: string (ISO),
  discountAmount: number,
  promotionType: string (ALL_PRODUCTS | ORDER_TOTAL | SPECIFIC_PRODUCTS),
  proportionType: string (PERCENTAGE | ABSOLUTE),
  minOrderValue: number,
  productIds: string[] (UUID)
}

API: GET /v1/promotions?page=0&pageSize=10
Response:
{
  currentPage: number,
  pageSize: number,
  totalPages: number,
  totalElements: number,
  isLast: boolean,
  isFirst: boolean,
  data: PromotionResDto[]
}

API: GET /v1/promotions/{id}
Response: PromotionResDto

--- CART ---
CartResDto:
{
  id: string (UUID),
  cartItems: CartItemResDto[]
}

API: GET /v1/carts/{id}
Response: CartResDto

--- ORDER ---
OrderResDto:
{
  id: string (UUID),
  totalPrice: number,
  paymentStatus: string,
  deliveryStatus: string,
  isShipCOD: boolean,
  orderDate: string (ISO),
  accountId: string (UUID),
  address: AddressResDto,
  usedPromotions: PromotionResDto[],
  orderItems: OrderItemResDto[]
}

API: GET /v1/orders/{id}
Response: OrderResDto

// TÃ i liá»‡u Ä‘Ã£ hoÃ n thiá»‡n cÃ¡c DTO chÃ­nh vÃ  API response.

===============================================================================
                    ğŸš€ SENIOR DEV IMPROVEMENT ROADMAP 
===============================================================================

ğŸ“Š CURRENT ASSESSMENT (Score: 7.2/10)
âœ… Strengths: Modern tech stack, clean architecture, type safety, scalable structure
âš ï¸  Issues: State management gaps, missing tests, performance optimizations, production setup

===============================================================================
                         ğŸ“‹ PHASE 1: CRITICAL FIXES
                        Priority: HIGH | Timeline: 1-2 weeks
===============================================================================

ğŸ”´ 1.1 STATE MANAGEMENT OVERHAUL
-----------------------------------
Target: Fix cart persistence vÃ  standardize state patterns

Tasks:
[ ] Implement CartStore vá»›i Zustand persistence
    File: src/store/cartStore.ts
    Features:
    - Cart items persistence (localStorage)
    - Optimistic updates
    - Quantity management
    - Price calculations vá»›i promotions
    - Item count badge
    
[ ] Implement ProductStore cho caching
    File: src/store/productStore.ts  
    Features:
    - Product list caching
    - Category-based filtering
    - Search functionality
    - Recently viewed products

[ ] Consolidate Auth patterns
    Action: Choose either Context hoáº·c Zustand, khÃ´ng mix both
    Recommendation: Keep Zustand authStore, remove AuthContext

Code Example:
```typescript
// src/store/cartStore.ts
interface CartStore {
  items: CartItemResDto[];
  isLoading: boolean;
  error: string | null;
  
  // Computed
  totalItems: number;
  totalPrice: number;
  
  // Actions  
  addItem: (product: ProductResDto, quantity: number) => Promise<void>;
  updateQuantity: (itemId: string, quantity: number) => Promise<void>;
  removeItem: (itemId: string) => Promise<void>;
  clearCart: () => void;
  syncWithServer: () => Promise<void>;
}
```

ğŸ”´ 1.2 ERROR HANDLING SYSTEM
----------------------------
Target: Production-ready error management

Tasks:
[ ] Global Error Boundary
    File: src/components/ErrorBoundary.tsx
    
[ ] API Error Handler Service  
    File: src/services/errorHandler.ts
    Features:
    - Centralized error logging
    - User-friendly error messages
    - Retry mechanisms
    - Network error detection

[ ] Toast Notification System
    File: src/components/common/ToastProvider.tsx
    Library: react-hot-toast hoáº·c sonner

ğŸ”´ 1.3 LOADING & UX IMPROVEMENTS
-------------------------------
Target: Better user experience

Tasks:
[ ] Global Loading States
    - Skeleton loaders cho products
    - Suspense boundaries
    - Loading spinners consistency
    
[ ] Error States UI
    - Empty states cho cart, products
    - Network error pages  
    - 404 error handling

===============================================================================
                        âš¡ PHASE 2: PERFORMANCE OPTIMIZATION  
                       Priority: HIGH | Timeline: 1-2 weeks
===============================================================================

ğŸŸ¡ 2.1 DATA FETCHING OPTIMIZATION
--------------------------------
Target: Add caching vÃ  smart data management

Tasks:
[ ] Implement React Query
    Package: @tanstack/react-query
    Benefits:
    - Automatic caching
    - Background refetching  
    - Optimistic updates
    - Infinite queries cho pagination

[ ] API Response Caching
    Strategy:
    - Products: 5 minutes cache
    - Categories: 30 minutes cache  
    - Cart: Real-time updates
    - Promotions: 10 minutes cache

Code Example:
```typescript
// Custom hooks vá»›i React Query
const useProducts = (categoryId?: string) => {
  return useQuery({
    queryKey: ['products', categoryId],
    queryFn: () => getProductsByCategory(categoryId),
    staleTime: 5 * 60 * 1000, // 5 minutes
    gcTime: 10 * 60 * 1000,   // 10 minutes
  });
};
```

ğŸŸ¡ 2.2 CODE SPLITTING & LAZY LOADING
-----------------------------------
Target: Reduce initial bundle size

Tasks:
[ ] Route-based code splitting
    Implementation:
    - React.lazy() cho táº¥t cáº£ pages
    - Suspense vá»›i loading fallbacks
    - Preload critical routes

[ ] Component-level splitting
    Strategy:
    - Heavy components (MaterialUI modals)
    - Third-party integrations
    - Admin-only components

ğŸŸ¡ 2.3 REACT PERFORMANCE
-----------------------
Target: Optimize rendering performance

Tasks:
[ ] Memoization audit
    Actions:
    - React.memo cho expensive components
    - useMemo cho calculations
    - useCallback cho event handlers
    
[ ] Virtual scrolling
    Component: ProductList, OrderHistory
    Library: @tanstack/react-virtual
    
[ ] Image optimization
    Strategy:
    - WebP format support
    - Lazy loading with Intersection Observer
    - Progressive image loading

===============================================================================
                           ğŸ§ª PHASE 3: TESTING STRATEGY
                        Priority: MEDIUM | Timeline: 2-3 weeks  
===============================================================================

ğŸŸ¢ 3.1 TESTING FOUNDATION SETUP
------------------------------
Target: Comprehensive testing pyramid

Tasks:
[ ] Unit Testing Setup
    Framework: Vitest (fast, Vite-native)
    Library: @testing-library/react
    Coverage: 80%+ target
    
[ ] Integration Testing
    Focus: API integration, form submissions
    Tools: MSW (Mock Service Worker)
    
[ ] E2E Testing Setup
    Framework: Playwright
    Critical paths: User journey, checkout flow

ğŸŸ¢ 3.2 TEST IMPLEMENTATION PRIORITY
---------------------------------
Target: Test critical business logic first

Phase 3a - Core Logic (Week 1):
[ ] utils/helpers.ts (promotion calculations) 
[ ] store/cartStore.ts (state management)
[ ] services/api.ts (API calls)

Phase 3b - Components (Week 2):
[ ] CartItem component
[ ] ProductCard component  
[ ] Forms (Login, Register, Address)

Phase 3c - Integration (Week 3):
[ ] Cart flow end-to-end
[ ] Checkout process
[ ] Authentication flow

Example Test Structure:
```typescript
// src/utils/__tests__/helpers.test.ts
describe('Promotion Calculations', () => {
  it('should apply percentage discount correctly', () => {
    const result = getProductPriceInfo('product-1', 100000);
    expect(result.finalPrice).toBe(80000); // 20% off
    expect(result.hasActivePromotion).toBe(true);
  });
});
```

===============================================================================
                          ğŸ—ï¸  PHASE 4: ARCHITECTURE IMPROVEMENTS
                         Priority: MEDIUM | Timeline: 2-3 weeks
===============================================================================

ğŸ”µ 4.1 FEATURE-BASED ARCHITECTURE  
---------------------------------
Target: Better code organization vÃ  team collaboration

Migration Plan:
```
src/
â”œâ”€â”€ features/
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ store/
â”‚   â”‚   â””â”€â”€ types/
â”‚   â”œâ”€â”€ products/
â”‚   â”œâ”€â”€ cart/
â”‚   â””â”€â”€ orders/
â””â”€â”€ shared/
    â”œâ”€â”€ components/
    â”œâ”€â”€ hooks/
    â”œâ”€â”€ services/
    â””â”€â”€ utils/
```

ğŸ”µ 4.2 CUSTOM HOOKS PATTERN
--------------------------
Target: Reusable business logic

Priority Hooks:
[ ] useCart() - Cart operations
[ ] useAuth() - Authentication 
[ ] useProducts() - Product fetching
[ ] useLocalStorage() - Persistent state
[ ] useDebounce() - Search optimization

ğŸ”µ 4.3 COMPONENT COMPOSITION
---------------------------
Target: More flexible, reusable components

Pattern Examples:
```typescript
// Compound component pattern
<Modal>
  <Modal.Header>Title</Modal.Header>
  <Modal.Body>Content</Modal.Body>
  <Modal.Footer>Actions</Modal.Footer>
</Modal>

// Render props pattern  
<DataFetcher url="/api/products">
  {({ data, loading, error }) => (
    <ProductList products={data} loading={loading} />
  )}
</DataFetcher>
```

===============================================================================
                            ğŸ” PHASE 5: PRODUCTION READINESS
                           Priority: LOW | Timeline: 2-3 weeks
===============================================================================

ğŸŸ£ 5.1 SECURITY ENHANCEMENTS
---------------------------
Tasks:
[ ] Input sanitization (DOMPurify)
[ ] XSS protection utilities
[ ] CSRF token handling
[ ] Content Security Policy setup
[ ] API rate limiting (client-side)

ğŸŸ£ 5.2 MONITORING & OBSERVABILITY  
--------------------------------
Tasks:
[ ] Error tracking (Sentry integration)
[ ] Performance monitoring (Web Vitals)
[ ] User analytics (PostHog/Mixpanel)
[ ] A/B testing framework setup

ğŸŸ£ 5.3 DEVOPS & DEPLOYMENT
-------------------------
Tasks:
[ ] Docker containerization
[ ] CI/CD pipeline (GitHub Actions)
[ ] Environment configuration (.env management)
[ ] Bundle analysis & optimization
[ ] Automated deployment to staging/production

===============================================================================
                               ğŸ“Š SUCCESS METRICS
===============================================================================

ğŸ¯ PHASE 1 COMPLETION CRITERIA:
- [ ] Cart persistence works across browser sessions
- [ ] No unhandled errors in production
- [ ] Loading states cho táº¥t cáº£ async operations
- [ ] Toast notifications cho user feedback

âš¡ PHASE 2 COMPLETION CRITERIA:  
- [ ] Bundle size < 500KB gzipped
- [ ] LCP < 2.5s, FID < 100ms, CLS < 0.1
- [ ] All API calls cached appropriately
- [ ] Lazy loading implemented

ğŸ§ª PHASE 3 COMPLETION CRITERIA:
- [ ] 80%+ test coverage  
- [ ] All critical paths cÃ³ E2E tests
- [ ] CI/CD pipeline runs tests automatically
- [ ] Zero test flakiness

ğŸ—ï¸  PHASE 4 COMPLETION CRITERIA:
- [ ] Feature-based folder structure
- [ ] All business logic in custom hooks  
- [ ] Components 100% reusable
- [ ] Zero circular dependencies

ğŸ” PHASE 5 COMPLETION CRITERIA:
- [ ] Zero security vulnerabilities
- [ ] Full production monitoring setup
- [ ] Automated deployments working
- [ ] Performance budgets enforced

===============================================================================
                                ğŸ–ï¸  FINAL GOALS
===============================================================================

ğŸ† TARGET SCORES AFTER COMPLETION:

| Aspect | Current | Target | Improvement |
|--------|---------|--------|-------------|
| Architecture | 8/10 | 9/10 | Feature-based structure |
| Code Quality | 8/10 | 9/10 | Testing + hooks pattern |
| Performance | 6/10 | 9/10 | React Query + optimizations |
| Testing | 3/10 | 8/10 | Comprehensive test suite |  
| Security | 7/10 | 9/10 | Production security measures |
| Production Ready | 6/10 | 9/10 | Full DevOps pipeline |

ğŸ¯ OVERALL TARGET: 8.7/10 (Production-ready enterprise application)

===============================================================================
                            ğŸ“ IMPLEMENTATION NOTES
===============================================================================

ğŸ”§ DEVELOPMENT WORKFLOW:
1. Create feature branch cho má»—i phase
2. Code review mandatory cho táº¥t cáº£ changes  
3. Testing before merge to main
4. Staging deployment cho manual testing
5. Production deployment sau full testing

âš ï¸  RISK MITIGATION:
- Backup current working version trÆ°á»›c major changes
- Incremental implementation (khÃ´ng big bang)
- Fallback plans cho má»—i major change
- Load testing trÆ°á»›c production deployment

ğŸ“š LEARNING RESOURCES:
- React Query documentation vÃ  best practices
- Testing Library patterns vÃ  strategies  
- Performance optimization guides
- Security best practices cho React apps

ğŸ‰ EXPECTED OUTCOMES:
- Production-ready ecommerce platform
- Maintainable, scalable codebase
- Excellent user experience  
- Zero production bugs
- Fast development velocity for future features

===============================================================================
                                   END PLAN
===============================================================================
